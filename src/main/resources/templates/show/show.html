<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.mx/thymeleaf/layout"
      layout:decorate="~{layouts/main}">
<head>
    <title th:text="${show.title}">Fiche d‚Äôun spectacle</title>
</head>
<body>
<div class="max-w-6xl mx-auto px-6 py-12">
    <div layout:fragment="content">

        <!-- Titre -->
        <h1 class="text-4xl font-extrabold text-gray-900 mb-6" th:text="${show.title}">Titre du spectacle</h1>

        <!-- Contenu principal -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-10 items-start mb-12">

            <!-- Affiche -->
            <div>
                <div th:if="${show.posterUrl != null}" class="aspect-[2/3] bg-white rounded shadow overflow-hidden">
                    <img th:src="@{'/images/' + ${show.posterUrl}}"
                         th:alt="${show.title}"
                         class="object-contain w-full h-full"/>
                </div>
                <div th:unless="${show.posterUrl}"
                     class="w-full aspect-[2/3] flex items-center justify-center bg-gray-100 text-gray-400 border rounded shadow">
                    Pas d‚Äôimage
                </div>
            </div>

            <!-- D√©tails -->
            <div class="md:col-span-2 space-y-5 text-gray-700 text-base">
                <!-- Lieu -->
                <p th:if="${show.location}">
                    <span class="font-semibold">Lieu de cr√©ation :</span>
                    <span th:text="${show.location.designation}">Espace Magh</span>
                </p>

                <!-- Description -->
                <p th:if="${show.description}" class="text-justify leading-relaxed">
                    <span class="font-semibold block mb-1 text-gray-800">Description :</span>
                    <span th:text="${show.description}">Texte du spectacle...</span>
                </p>

                <!-- Infos -->
                <div class="flex flex-wrap gap-2 mt-3">
                    <span th:if="${show.bookable}"
                          class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">R√©servable</span>
                    <span th:unless="${show.bookable}"
                          class="px-3 py-1 bg-red-100 text-red-600 rounded-full text-xs font-medium">Non r√©servable</span>

                    <span th:if="${show.prices != null and !#lists.isEmpty(show.prices)}"
                          class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium"
                          th:text="${show.prices[0].price + ' ‚Ç¨'}">9.99 ‚Ç¨</span>
                    <span th:if="${show.prices == null or #lists.isEmpty(show.prices)}"
                          class="italic text-gray-400 text-xs">Prix non d√©fini</span>
                </div>
            </div>
        </div>

        <!-- Repr√©sentations -->
        <div class="mb-10">
            <h2 class="text-2xl font-bold text-gray-800 mb-3">Repr√©sentations</h2>
            <ul th:if="${#lists.size(show.representations) > 0}"
                class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 text-gray-600">
                <li th:each="representation : ${show.representations}"
                    class="bg-gray-50 p-3 rounded shadow-sm border text-center"
                    th:text="${#temporals.format(representation.when,'dd-MM-yyyy HH:mm')}">
                    12-10-2012 13:30
                </li>
            </ul>
            <p th:if="${#lists.size(show.representations) == 0}" class="italic text-gray-400">
                Aucune repr√©sentation pr√©vue.
            </p>
        </div>
        <!-- Commentaires -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Commentaires</h2>

            <!-- Aucun commentaire -->
            <div th:if="${#lists.isEmpty(reviews)}" class="italic text-gray-500 mb-6">
                Aucun commentaire pour ce spectacle pour l‚Äôinstant.
            </div>

            <!-- Liste des commentaires -->
            <div th:each="review : ${reviews}" class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm mb-4">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <strong th:text="${review.user.login}" class="text-gray-800"></strong>
                        <span class="text-yellow-600 text-sm font-semibold ml-2" th:text="'‚≠ê ' + ${review.stars} + '/5'">‚≠ê 4/5</span>
                    </div>

                    <!-- Bouton de suppression -->
                    <form th:if="${#authentication.name == review.user.login}"
                          th:action="@{/reviews/delete}" method="post"
                          onsubmit="return confirm('Voulez-vous vraiment supprimer ce commentaire ?');">
                        <input type="hidden" name="reviewId" th:value="${review.id}" />
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit" class="text-red-600 hover:text-red-800 text-lg ml-2" title="Supprimer">
                            üóëÔ∏è
                        </button>
                    </form>
                </div>

                <p class="text-gray-700 mb-2" th:text="${review.review}">Contenu du commentaire</p>
                <small class="text-gray-400" th:text="${#temporals.format(review.createdAt, 'dd/MM/yyyy HH:mm')}">Date</small>
            </div>

            <!-- Formulaire de commentaire -->
            <div th:if="${#authorization.expression('isAuthenticated()')}" class="mt-8">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Laisser un commentaire</h3>
                <form th:action="@{/reviews/submit}" method="post" class="space-y-4 bg-gray-50 p-6 rounded shadow border border-gray-200">
                    <input type="hidden" name="showId" th:value="${show.id}" />
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <div>
                        <label for="review" class="block font-medium text-gray-700">Votre commentaire</label>
                        <textarea id="review" name="review" class="w-full border rounded px-3 py-2 mt-1 text-sm" rows="4" required></textarea>
                    </div>

                    <div>
                        <label for="stars" class="block font-medium text-gray-700">Note (1 √† 5)</label>
                        <input type="number" id="stars" name="stars" min="1" max="5" class="w-20 border rounded px-2 py-1 mt-1 text-sm" required />
                    </div>

                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
                        Envoyer
                    </button>
                </form>
            </div>

            <!-- Message pour les visiteurs -->
            <div th:unless="${#authorization.expression('isAuthenticated()')}" class="mt-6 text-gray-600">
                üîí <a th:href="@{/login}" class="text-blue-600 hover:underline">Connectez-vous</a> pour poster un commentaire.
            </div>
        </div>


        <!-- Collaborateurs -->
        <div class="mb-10">
            <h2 class="text-2xl font-bold text-gray-800 mb-3">Collaborateurs</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
                <div th:if="${collaborateurs['auteur'] != null and !#lists.isEmpty(collaborateurs['auteur'])}">
                    <p class="font-semibold text-gray-800 mb-1">Auteur(s) :</p>
                    <ul class="list-disc list-inside">
                        <li th:each="auteur : ${collaborateurs['auteur']}"
                            th:text="${auteur.firstname + ' ' + auteur.lastname}">Nom
                        </li>
                    </ul>
                </div>

                <div th:if="${collaborateurs['sc√©nographe'] != null and !#lists.isEmpty(collaborateurs['sc√©nographe'])}">
                    <p class="font-semibold text-gray-800 mb-1">Metteur(s) en sc√®ne :</p>
                    <ul class="list-disc list-inside">
                        <li th:each="sceno : ${collaborateurs['sc√©nographe']}"
                            th:text="${sceno.firstname + ' ' + sceno.lastname}">Nom
                        </li>
                    </ul>
                </div>

                <div th:if="${collaborateurs['com√©dien'] != null and !#lists.isEmpty(collaborateurs['com√©dien'])}">
                    <p class="font-semibold text-gray-800 mb-1">Distribution :</p>
                    <ul class="list-disc list-inside">
                        <li th:each="comedien : ${collaborateurs['com√©dien']}"
                            th:text="${comedien.firstname + ' ' + comedien.lastname}">Nom
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Retour -->
        <div class="text-sm">
            <a th:href="@{/shows}" class="text-blue-600 hover:underline">&larr; Retour √† la liste</a>
        </div>

    </div>
</div>
</body>
</html>
