<!DOCTYPE html>
<html lang="fr"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}">
<head>
    <!-- Concaténation correcte : un seul ${…} -->
    <title th:text="${artist.firstname + ' ' + artist.lastname}">Fiche d’un artiste</title>
</head>
<body>
<div layout:fragment="content" class="max-w-3xl mx-auto px-6 py-8">

    <!-- Titre -->
    <h1 class="text-2xl font-semibold mb-4"
        th:text="${artist.firstname + ' ' + artist.lastname}">
        Nom Prénom
    </h1>

    <!-- Affichage de la troupe -->
    <div class="mb-6">
        <h2 class="font-medium mb-1">Troupe :</h2>

        <div th:if="${artist.troupe != null}" class="flex items-center gap-4">
            <!-- Si logoUrl est une URL absolue ou relative à /static/images, on peut l’utiliser directement -->
            <img th:src="${artist.troupe.logoUrl}"
                 alt="Logo de la troupe"
                 class="w-12 h-auto rounded"/>
            <span th:text="${artist.troupe.name}" class="font-medium">Nom de la troupe</span>
        </div>

        <p th:unless="${artist.troupe != null}" class="italic text-gray-500">
            Non affilié
        </p>
    </div>

    <!-- Formulaire d’affectation (admin uniquement) -->
    <div sec:authorize="hasRole('ADMIN')" class="mt-8 bg-gray-50 p-4 rounded shadow-sm">
        <form th:action="@{/artists/{id}/affect-troupe(id=${artist.id})}"
              method="post"
              class="flex items-center gap-4">
            <label for="troupeSelect" class="font-medium">Affecter à :</label>
            <select id="troupeSelect" name="troupeId"
                    class="border rounded px-2 py-1">
                <!-- valeur vide pour désaffilier -->
                <option value=""
                        th:selected="${artist.troupe == null}">
                    Non affilié
                </option>
                <option th:each="t : ${troupes}"
                        th:value="${t.id}"
                        th:text="${t.name}"
                        th:selected="${artist.troupe != null} and (t.id == artist.troupe.id)">
                </option>
            </select>
            <button type="submit"
                    class="bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700 transition">
                Enregistrer
            </button>
        </form>
    </div>

    <!-- Lien retour -->
    <div class="mt-6">
        <a th:href="@{/artists}" class="text-blue-600 hover:underline">
            ← Retour à la liste des artistes
        </a>
    </div>

</div>
</body>
</html>
